<!DOCTYPE html>
<html ng-app="scotchApp" xmlns="http://www.w3.org/1999/xhtml">
<head>
   
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-animate.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular-sanitize.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-2.5.0.js"></script>
    <script src="Scripts/example.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">


    <!-- SCROLLS -->
    <!-- load bootstrap and fontawesome via CDN -->
    <!--
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" />
        -->
    <!-- SPELLS -->
    <!-- load angular and angular route via CDN -->
     
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.js"></script>
       
    <script src="Scripts/script.js"></script>
    <style>
        body{font-family:Arial; font-size:10pt;}
        ui-state-error-text ui-state-error 
        {
            color:#1e90ff;
        }      
        
        #location li{list-style:none;opacity:1;background-color:#fff; width:auto;padding:2px;padding-right:10px;cursor:pointer}      
        #location li:hover{background-color:#1e90ff;color:#fff}

        .lileft{float:left;}
        .liright{float:right;}
        #location{background-color:#fff; height:auto;width:auto;position:fixed;text-align:left;}

        #loclist li{float:none;border-width:1px;border-color:#ff0000;border-top-color:#fff}

        #mainsearch td {background-color:transparent}
       td{vertical-align:top; font-size:10pt;background-color:#fff}
        
        .htlname{color:#1e90ff;font-size:12pt;font-weight:bold}
        .priceDisplay{color:#ff0000;font-size:14pt;vertical-align:middle;font-weight:bold;width:10%}


        .bookbtntd{vertical-align:middle;width:10%}
        .bookbtn{color:#fff;background:#1e90ff;font-size:12pt; text-decoration:none;padding:2px}
        .shortDesc{font-size:9pt;font-weight:normal}
       .dottedtr{border-top:dotted;border-top-color:#1e90ff;border-top-width:1px;padding:5px;background-color:#fff}
       .hf{background-color:#1a1717;color:#fff;padding:10px;font-weight:bold;font-size:12pt}
       .hf2{background-color:#1a1717;color:#fff;padding:3px;}
       .searchbtn{}
       .mainsearchdiv{opacity:.8;background-color:#fff;width:20%; height:auto; padding:10px; text-align:center; min-width:200px}

       .htlopt{
         background-color:#fff;padding:5px; list-style-type:none;width:90%
       }

       .htlopt li{float:left; list-style-type:none;}

       .gv{width:90%}

       .htloptborder{border-bottom-color:#1e90ff;border-bottom-width:unset;border-bottom-style:dotted}
        .pop {
        }



    </style>
    

    
</head>
<body ng-controller="mainController">
    <!-- angular templating -->
    <!-- this is where content will be injected -->
    <header>
        <nav class="navbar navbar-default">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/">Angular Routing Example</a>
                </div>

                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#"><i class="fa fa-home"></i> Home</a></li>
                    <li><a href="#about"><i class="fa fa-shield"></i> About</a></li>
                    <li><a href="#contact"><i class="fa fa-comment"></i> Contact</a></li>
                    <li><a href="#xhotels"><i class="fa fa-comment"></i> Hotels</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="modalImage">
        <div class="modal-header">
            {{selectedImg.header}}
            <button ng-click="$dismiss()" class="close pull-right"
                    aria-hidden="true">
                &times;
            </button>
            <div class="clearfix"></div>
        </div>
        <div class="modal-body">
            <div class="image-wrapper">
                <a ng-href="{{ImageSrc}}" target="_blank">
                    <img ng-src={{ImageSrc}}>
                </a>
            </div>
            <div class="text-muted image-description">
                {{ImageDescription}}
            </div>
        </div>
    </div>

    <div id="main">

        <div ng-view></div>
    </div>
   
<table id="mainsearch" style="width:100%;height:250px; background-size: cover; text-align:center;background-image:url(http://www.lowestroomrates.com/images/27528_351_z.jpg)">
    <tr>
        <td align="center" valign="middle"  style="top:50px;position:relative">
         <div class="mainsearchdiv">
            <div>
                <h1>Search hotels</h1>
            </div>
            <div>
                <div>
                <input type="text" id="locid" name="locid" value="noloc" size="25" oninput="getLocation()"/>
                    <asp:TextBox  id="location" name="location" runat="server" Width="350px" CssClass="textboxAuto"  Font-Size="12px" />

                <div id="location">
                    <ul id="loclist" style="padding:0px;opacity:1;"></ul>
                </div>
                </div>


                <input type="button" value="Search" class="searchbtn" onclick="findHotel()" />
                <a   class="searchbtn" target="_blank" href="hotels/114200/London">test basic</a>
                <a class="searchbtn" target="_blank" href="hotels/114200/London/GB">test digest</a>
            </div>
          </div>
        </td>
    </tr>
    
</table>
   
        <table id="gridview22" class="display" width="100%" align="center" cellspacing="0" style="font-weight:bold;color:#272525;background-color:#fff">
            <tr><td>
            <div id="gridview2"/>
                </td></tr>
        </table>
    
    <a href="#" id="pop1" class="pop">
        <img id="imageresource" src="http://images.lowestroomrates.com/hotels/1000000/800000/795900/795873/8a2b2018_t.jpg" alt="http://images.lowestroomrates.com/hotels/1000000/800000/795900/795873/8a2b2018_y.jpg">
        Click to Enlarge
    </a>

    
    <!-- Creates the bootstrap modal where the image will appear -->
    <div class="modal fade" style="position:relative;left:10px" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Image preview</h4>
                </div>
                <div class="modal-body">
                    <img src="" style="width:100%;position:center" id="imagepreview">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    


    <div class="modal fade" style="position:relative;left:10px" id="imagemodal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Image preview</h4>
                </div>
                <div class="modal-body">
                    <img src="" style="width:100%;position:center" id="imagepreview1">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
        <table id="colr" border="0" class="ui-jqgrid"></table>
        <div id="pcolr" style="visibility:visible"></div>
        <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>

        <script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
    </script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script>
            (function ($) {
                $.fn.extend({
                    center: function () {
                        return this.each(function () {
                            var top = ($(window).height() - $(this).outerHeight()) / 2;
                            var left = ($(window).width() - $(this).outerWidth()) / 2;
                            $(this).css({ position: 'absolute', margin: 0, top: (top > 0 ? top : 0) + 'px', left: (left > 0 ? left : 0) + 'px' });
                        });
                    }
                });
            })(jQuery);
            
           /* $(".pop").on("click", function () {
               

                $('#imagepreview').attr('src', $('#imageresource').attr('alt')); // here asign the image to the modal when the user click the enlarge link
                $('#imagemodal').modal('show'); // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
                $('#imagemodal').center();
            });*/

            function doPop(id)
            {
                $(id).on("click", function () {
                    $('#imagepreview').attr('src', $(id).attr('alt')); // here asign the image to the modal when the user click the enlarge link
                    $('#imagemodal').modal('show'); // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
                    $('#imagemodal').center();
                });
            }
         
            function getEventTarget(e) {
                e = e || window.event;
                return e.target || e.srcElement;
            }

            var ul = document.getElementById('loclist');
            ul.onclick = function (event) {
                var target = getEventTarget(event);
                var locc = document.getElementById('locid');
                if (locc != null) {
                    locc.value = target.innerHTML;
                    $("#loclist").hide();
                }
            };




            var uri = 'hotels/';



            function formatItem(item) {
                return item.name + ': ' + item.hotelid + '<img src="' + item.thumbnailurl + '"/>';
            }

            function findHotel() {
                
                $.getJSON(uri + document.getElementById('locid').value)
                    .done(function (data) {
                      
                        $("#gridview2").empty();
                        $("#gridview2").append('<table>');
                        $("#gridview2").append('<tr><td class="hf">Hotel search results</td></tr>');
 
                       
                        // On success, 'data' contains a list of products.
                        if ((data == null) || (data == "")) return;
                        $.each(data, function (key, item) {

                                if ((item.thumbnailurl != '') && (item.thumbnailurl != null))
                                    $("#gridview2").append(
                                        '<tr><td ><ul class="htlopt">' +
                                         '<li style="width:250px"><img width="250px" src="' + item.thumbnailurl + '" /></li>' +
                                         '<li style="float:left;width:50%"><table width="100%"><tr>   <td class="htlname">' + item.name + '</td></tr><tr>   <td>' + item.address1 + '</td></tr><tr>   <td>' + item.city + '</td></tr><tr>   <td>' + item.locationdescription + '</td></tr><tr>   <td class="shortDesc">' + item.shortdescription + '</td></tr></table>       </li>' +
                                         '<li>'+
                                           '<span class="priceDisplay">' + item.lowrate + '</span>  <a target="_blank" href="http://www.lowestroomrates.com/avails/wa'+  item.hotelid  +'" class="bookbtn">See&nbsp;details</a>'+
                                           '<form id="frmhd' + item.hotelid + '"><a class="searchbtn" href="#hdetails' + item.hotelid + '" onclick="findHotelDetailsSub( ' + item.hotelid + ' )">See test details</a><input type="hidden" id="hotelid" value="' + item.hotelid + '" /></form>' +
                                        '</li></ul></td></tr>' +
                                        '<tr><td ><ul class="htlopt"><li>' +
                                        '<div id="hdetails' + item.hotelid + '"></div>' +
                                        '</li>' +
                                        '</ul></td></tr>' +

                                        '<tr><td ><ul class="htlopt"><li>' +
                                        '<div id="idetails' + item.hotelid + '"></div>' +
                                        '</li>' +
                                        '</ul></td></tr>' +
                                        '<tr><td ><ul class="htlopt"><li>' +
                                        '<div id="rdetails' + item.hotelid + '"></div>' +
                                        '</li>' +
                                        '</ul></td></tr>' +
                                        '<tr><td ><ul class="htlopt"><li>' +
                                        '<div id="sdetails' + item.hotelid + '"></div>' +
                                        '</li>' +
                                        '</ul></td></tr>' +
                                        '<tr><td class="htloptborder"></td></tr>'

                                        );
                        });
                        $("#gridview2").append('</table>');
                    });
            }


            function findHotelDetailsSub(frm) {
               
                var frm = document.getElementById('frmhd' + frm);
               
                if (frm == null) return false;
                

                $.getJSON('hoteldetails/' + frm.hotelid.value + '/')
                    .done(function (data) {
                        $("#hdetails" + frm.hotelid.value).empty();
                       
                        // On success, 'data' contains a list of location.
                        $("#hdetails" + frm.hotelid.value).append('<table style="font-size:10px;font-weight:normal;" id="table' + frm.hotelid.value + '">');
                        $("#hdetails" + frm.hotelid.value).append('<tr><td><a href="#" onclick="toggle(' + frm.hotelid.value + ')">Show</a></td></tr><tr><td>');

                        $.each(data, function (key, item) {
                          
                            
                            if (key == "HotelSummary") { /*$("#hdetails" + frm.hotelid.value).append('<table><tr><td class="hf">' + item.name + '</td></tr></table>');*/
                            } else
                                if (key == "HotelDetails") {
                                    $("#hdetails" + frm.hotelid.value).append('<table style="font-size:10px;font-weight:normal"><tr><td>' + htmlDecode(item.propertyDescription) + htmlDecode(item.hotelPolicy) + htmlDecode(item.roomInformation) + '</td></tr></table>');
                                } else
                                    if (key == "HotelRooms") {
                                        $("#rdetails" + frm.hotelid.value).append('<table style="font-size:10px;font-weight:normal">');
                                        $.each(item, function (key2, item2) {                                        
                                            $.each(item2, function (key3, room) {
                                                $("#rdetails" + frm.hotelid.value).append('<tr><td>' + room.description + '</td><td>' + room.descriptionLong + '</td></tr>');


                                            })
                                            
                                        })
                                        $("#rdetails" + frm.hotelid.value).append('</table>');
                                    }
                                    else
                                        if (key == "HotelImages") {
                                            $.each(item, function (key2, item2) {
                                                $("#idetails" + frm.hotelid.value).append('<table><tr><td>');
                                                var totimg = item2.length;
                                                var maxperLine = 10;
                                                var imgcount = 0;
                                                $.each(item2, function (key3, imgdata) {
                                                    if ((imgcount % maxperLine) == 0) $("#idetails" + frm.hotelid.value).append('<ul>');
                                                    $("#idetails" + frm.hotelid.value).append('<li class="hf2"><a href="#'+imgdata.imgid+'" id="pop' + frm.hotelid.value + '"  onclick="doPop(&apos;#im' + imgdata.imgid + '&apos;)"><img id="im' + imgdata.imgid + '" height="50" width="80" src="' + imgdata.url + '" alt="' + imgdata.url + '"></a></li>');
                                                    if ((imgcount % maxperLine) == 0) $("#idetails" + frm.hotelid.value).append('</ul>');
                                                    ++imgcount;
                                                })
                                                $("#idetails" + frm.hotelid.value).append('</td></tr></table>');

                                            }

                                            );


                                            // $("#loclist").append('<li>' + item.Name + ', ' + item.City + '</li>');

                                        }
                        });
                        $("#hdetails" + frm.hotelid.value).append('</td></tr></table>');


                      //  $("#hdetails" + frm.hotelid.value).show();
                       

                    })
                .fail(function (request, status, error) {
                    alert('failed:' + error);
                });

            }

            function htmlEncode(value) {
                //create a in-memory div, set it's inner text(which jQuery automatically encodes)
                //then grab the encoded contents back out.  The div never exists on the page.
                return $('<div/>').text(value).html();
            }

            function toggle(id) {
                var visible = $('#table' + id).is(":visible");
                if (visible)
                     $('#table' + id).hide();
                else
                     $('#table' + id).show();
            }

            function htmlDecode(value) {
                return $('<div/>').html(value).text();
            }

            function findHotelDetails(hi, city) {

                $.getJSON('hotels/' + hi + '/' + city)
                    .done(function (data) {

                        alert('success');
                        // On success, 'data' contains a list of location.
                        $.each(data, function (key, item) {

                            // $("#loclist").append('<li>' + item.Name + ', ' + item.City + '</li>');

                        });

                    })
                .fail(function (request, status, error) {
                    alert('failed:' + error);
                });

            }


            function findHotelDetails2(hi, city) {
                $.getJSON('hotels/' + hi + '/' + city)
                    .done(function (data) {

                        alert('success');
                        // On success, 'data' contains a list of location.
                        $.each(data, function (key, item) {

                            // $("#loclist").append('<li>' + item.Name + ', ' + item.City + '</li>');

                        });

                    })
                .fail(function (request, status, error) {
                    alert('failed:' + error);
                });
            }


            function getLocation() {

                if (document.getElementById('locid').value.length < 3) { $("#loclist").hide(); return };
                $.getJSON('locations/' + document.getElementById('locid').value)
                    .done(function (data) {
                        $("#loclist").empty();

                        // On success, 'data' contains a list of location.
                        $.each(data, function (key, item) {

                            $("#loclist").append('<li>' + item.City + ', ' + item.CountryCode + '</li>');

                        });
                        $("#loclist").show();
                    });
            }


            function find() {
                $.getJSON(uri)
                    .done(function (data) {
                        // On success, 'data' contains a list of products.
                        $.each(data, function (key, item) {
                            // Add a list item for the product.
                            //$('<li>', { text: formatItem(item) }).appendTo($('#products'));
                            //$('#images').append('<img src="' + item.thumbnailurl + '" title="'+item.name+'" alt="'+item.name+'" />');
                            //for (var i = 0; i < data.length; i++)
                            {
                                if ((item.thumbnailurl != '') && (item.thumbnailurl != null))
                                    $("#gridview2").append('<tr><td><img src="' + item.thumbnailurl + '"/></td><td>' + item.name + '</td><td>' + item.city + '</td><td class="priceDisplay">' + item.lowrate + '</td></tr>');
                                else
                                    $("#gridview2").append('<tr><td></td><td>' + item.name + '</td><td>' + item.city + '</td><td>' + item.lowrate + '</td></tr>');
                            };

                        });
                    });
            }

            function find0() {
                var id = $('#prodId').val();
                $.getJSON(uri + '/' + id)
                    .done(function (data) {
                        $('#product').text(formatItem(data));
                    })
                    .fail(function (jqXHR, textStatus, err) {
                        $('#product').text('Error: ' + err);
                    });
            }

            function find2() {
                var id = $('#prodId').val();
                $.getJSON(uri + '/' + id)
                    .done(function (data) {
                        // On success, 'data' contains a list of products.
                        $.each(data, function (key, item) {
                            // Add a list item for the product.
                            $('<li>', { text: formatItem(item) }).appendTo($('#products'));
                            $('#images').append('<img src="' + item.thumbnailurl + '" alt="something" />');


                        });
                    });
            }
        </script>



</body>
</html>